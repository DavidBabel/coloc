function v(t,e=!1){let n="01/01/1970",o=0;return t.forEach(({date:a,price:l})=>{a>n&&(n=a,o=l)}),e?n:o}function T(t){return t==="disponible"?{icon:"",label:""}:t===!1?{icon:"❌",label:""}:typeof t=="string"?{icon:"",label:` - ${window.translations?.availableFrom||"dispo le"} ${t}`}:{icon:"",label:""}}function M(t,e,n,o){return!window.allRoomTranslations||!window.allRoomTranslations[t]?`${n} ${window.apartmentData.rooms.find(i=>i.labelKey===t)?.label||t}${o}`:(window.locales||["fr","en","es","it","de"]).map(i=>{const c=window.allRoomTranslations[t][i]||t;return`<span class="${i}">${n} ${c}${o}</span>`}).join("")}function p(){let t="",e=-1;window.apartmentData.rooms.forEach((o,a)=>{const{icon:l,label:i}=T(o.available),c=localStorage.getItem("adminMode")==="true"||document.body.classList.contains("admin")||typeof window.admin<"u"&&window.admin,s=!c&&o.available===!1,r=s?"opacity-50 cursor-not-allowed":"hover:bg-base-200 cursor-pointer";e===-1&&(c||o.available!==!1)&&(e=a);const d=M(o.labelKey,window.currentLanguage,l,i);t+=`
        <li class="mb-0.5">
          <label class="label justify-start rounded-lg p-2 transition-colors select-none ${r}">
            <input
              type="checkbox"
              name="room"
              value="${a}"
              class="checkbox checkbox-primary checkbox-sm mr-3"
              ${s?"disabled":""}
            />
            <span class="label-text text-sm font-medium ${s?"text-gray-400":""}">
              ${d}
            </span>
          </label>
        </li>`}),e===-1&&(e=0);const n=document.getElementById("rooms");n&&(n.innerHTML=t),b(e),setTimeout(()=>w(),0)}function b(t){window.lastRoomIndex=t;const e=window.apartmentData.rooms[t],n=window.apartmentData,o=document.getElementById("apl-checkbox"),a=o?o.checked:!1,l=v(e.price_history),i=l+n.charges-(a?100:0),{label:c}=T(e.available),s=document.getElementById("room");if(s){const m=M(e.labelKey,window.currentLanguage,"","");s.innerHTML=m}const r=document.getElementById("room-availability");r&&(c?(r.innerHTML=c.replace(" - ",""),r.style.display="block"):r.style.display="none");const d=document.querySelector(".loyer");d&&(d.innerHTML=l+" €");const h=document.querySelector(".apl");h&&(h.innerHTML=a?"-100 €":"0 €");const y=document.querySelector(".charges");y&&(y.innerHTML=n.charges+" €");const g=document.querySelector(".caution");g&&(g.innerHTML=n.caution+" €");const E=document.querySelector(".total");E&&(E.innerHTML=i+" €");const L=document.querySelector(".insurance");L&&(L.innerHTML="≈ "+n.insurance+" €");const u=document.getElementById("room-image"),f=document.getElementById("room-image-mobile");e.img&&(u&&(u.src=e.img,u.alt=e.label),f&&(f.src=e.img,f.alt=e.label)),document.querySelectorAll('input[name="room"]').forEach((m,A)=>{A===t?m.checked=!0:m.checked=!1})}function S(){if(window.lastRoomIndex!==-1){const t=window.apartmentData.rooms[window.lastRoomIndex],e=window.apartmentData,n=document.getElementById("apl-checkbox"),o=n?n.checked:!1,l=v(t.price_history)+e.charges-(o?100:0),i=document.querySelector(".apl");i&&(i.innerHTML=o?"-100 €":"0 €");const c=document.querySelector(".total");c&&(c.innerHTML=l+" €")}else p()}window.updatePrices=S;document.addEventListener("DOMContentLoaded",function(){p(),w(),setTimeout(()=>{k()},100),document.addEventListener("adminModeChanged",function(t){p(),w(),setTimeout(()=>{k()},100)})});function k(){if(document.querySelectorAll(".info-icon").forEach(e=>{const n=e.parentElement?.querySelector(".mobile-popover");if(e&&n&&!e.hasAttribute("data-initialized")){e.setAttribute("data-initialized","true");const o=a=>{a.stopPropagation(),document.querySelectorAll(".mobile-popover.show").forEach(l=>{l!==n&&l.classList.remove("show")}),n.classList.toggle("show")};e.addEventListener("click",o),e._clickHandler=o}}),!document.body.hasAttribute("data-popover-listener")){document.body.setAttribute("data-popover-listener","true");const e=n=>{n.target.closest(".info-icon")||document.querySelectorAll(".mobile-popover.show").forEach(o=>{o.classList.remove("show")})};document.addEventListener("click",e),document.body._clickOutsideHandler=e}}function w(){const t=document.querySelectorAll('input[name="room"]');t.forEach((e,n)=>{e.addEventListener("change",()=>{if(e.checked)t.forEach(o=>{o!==e&&(o.checked=!1)}),b(n);else if(!Array.from(t).some(a=>a.checked)){let a=0;const l=localStorage.getItem("adminMode")==="true"||document.body.classList.contains("admin")||typeof window.admin<"u"&&window.admin;for(let i=0;i<window.apartmentData.rooms.length;i++){const c=window.apartmentData.rooms[i];if(l||c.available!==!1){a=i;break}}t[a].checked=!0,b(a)}})})}
