function k(o,e=!1){let t="01/01/1970",n=0;return o.forEach(({date:a,price:l})=>{a>t&&(t=a,n=l)}),e?t:n}function A(o){return o==="disponible"?{icon:"",label:""}:o===!1?{icon:"❌",label:""}:typeof o=="string"?{icon:"",label:` - ${window.translations?.availableFrom||"dispo le"} ${o}`}:{icon:"",label:""}}function u(){let o="",e=-1;window.apartmentData.rooms.forEach((n,a)=>{const{icon:l,label:i}=A(n.available),c=localStorage.getItem("adminMode")==="true"||document.body.classList.contains("admin")||typeof window.admin<"u"&&window.admin,r=!c&&n.available===!1,s=r?"opacity-50 cursor-not-allowed":"hover:bg-base-200 cursor-pointer";e===-1&&(c||n.available!==!1)&&(e=a),o+=`
        <li class="mb-0.5">
          <label class="label justify-start rounded-lg p-2 transition-colors select-none ${s}">
            <input
              type="checkbox"
              name="room"
              value="${a}"
              class="checkbox checkbox-primary checkbox-sm mr-3"
              ${r?"disabled":""}
            />
            <span class="label-text text-sm font-medium ${r?"text-gray-400":""}">
              ${l} ${n.label}${i}
            </span>
          </label>
        </li>`}),e===-1&&(e=0);const t=document.getElementById("rooms");t&&(t.innerHTML=o),f(e),setTimeout(()=>b(),0)}function f(o){window.lastRoomIndex=o;const e=window.apartmentData.rooms[o],t=window.apartmentData,n=document.getElementById("apl-checkbox"),a=n?n.checked:!1,l=k(e.price_history),i=l+t.charges-(a?100:0),{label:c}=A(e.available),r=document.getElementById("room");r&&(r.innerHTML=`${e.label}`);const s=document.getElementById("room-availability");s&&(c?(s.innerHTML=c.replace(" - ",""),s.style.display="block"):s.style.display="none");const p=document.querySelector(".loyer");p&&(p.innerHTML=l+" €");const h=document.querySelector(".apl");h&&(h.innerHTML=a?"-100 €":"0 €");const y=document.querySelector(".charges");y&&(y.innerHTML=t.charges+" €");const w=document.querySelector(".caution");w&&(w.innerHTML=t.caution+" €");const g=document.querySelector(".total");g&&(g.innerHTML=i+" €");const E=document.querySelector(".insurance");E&&(E.innerHTML="≈ "+t.insurance+" €");const d=document.getElementById("room-image"),m=document.getElementById("room-image-mobile");e.img&&(d&&(d.src=e.img,d.alt=e.label),m&&(m.src=e.img,m.alt=e.label)),document.querySelectorAll('input[name="room"]').forEach((L,x)=>{x===o?L.checked=!0:L.checked=!1})}function M(){if(window.lastRoomIndex!==-1){const o=window.apartmentData.rooms[window.lastRoomIndex],e=window.apartmentData,t=document.getElementById("apl-checkbox"),n=t?t.checked:!1,l=k(o.price_history)+e.charges-(n?100:0),i=document.querySelector(".apl");i&&(i.innerHTML=n?"-100 €":"0 €");const c=document.querySelector(".total");c&&(c.innerHTML=l+" €")}else u()}window.updatePrices=M;document.addEventListener("DOMContentLoaded",function(){u(),b(),setTimeout(()=>{v()},100),document.addEventListener("adminModeChanged",function(o){u(),b(),setTimeout(()=>{v()},100)})});function v(){document.querySelectorAll(".tooltip").forEach(e=>{const t=e.querySelector(".info-icon"),n=e.querySelector(".mobile-popover");if(t&&n){const a=n.textContent?.trim()||"";e.setAttribute("data-tip",a),t.hasAttribute("data-initialized")||(t.setAttribute("data-initialized","true"),window.innerWidth<=800&&t.addEventListener("click",l=>{l.stopPropagation(),document.querySelectorAll(".mobile-popover.show").forEach(i=>{i!==n&&i.classList.remove("show")}),n.classList.toggle("show")}))}}),window.innerWidth<=800&&!document.body.hasAttribute("data-popover-listener")&&(document.body.setAttribute("data-popover-listener","true"),document.addEventListener("click",e=>{e.target.closest(".tooltip")||document.querySelectorAll(".mobile-popover.show").forEach(t=>{t.classList.remove("show")})}))}function b(){const o=document.querySelectorAll('input[name="room"]');o.forEach((e,t)=>{e.addEventListener("change",()=>{if(e.checked)o.forEach((n,a)=>{n!==e&&(n.checked=!1)}),f(t);else if(!Array.from(o).some(a=>a.checked)){let a=0;const l=localStorage.getItem("adminMode")==="true"||document.body.classList.contains("admin")||typeof window.admin<"u"&&window.admin;for(let i=0;i<window.apartmentData.rooms.length;i++){const c=window.apartmentData.rooms[i];if(l||c.available!==!1){a=i;break}}o[a].checked=!0,f(a)}})})}
