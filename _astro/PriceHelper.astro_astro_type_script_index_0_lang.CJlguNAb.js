function v(t,e=!1){let o="01/01/1970",n=0;return t.forEach(({date:a,price:i})=>{a>o&&(o=a,n=i)}),e?o:n}function A(t){return t==="disponible"?{icon:"",label:""}:t===!1?{icon:"❌",label:""}:typeof t=="string"?{icon:"",label:` - ${window.translations?.availableFrom||"dispo le"} ${t}`}:{icon:"",label:""}}function u(){let t="",e=-1;window.apartmentData.rooms.forEach((n,a)=>{const{icon:i,label:l}=A(n.available),c=localStorage.getItem("adminMode")==="true"||document.body.classList.contains("admin")||typeof window.admin<"u"&&window.admin,r=!c&&n.available===!1,s=r?"opacity-50 cursor-not-allowed":"hover:bg-base-200 cursor-pointer";e===-1&&(c||n.available!==!1)&&(e=a),t+=`
        <li class="mb-0.5">
          <label class="label justify-start rounded-lg p-2 transition-colors select-none ${s}">
            <input
              type="checkbox"
              name="room"
              value="${a}"
              class="checkbox checkbox-primary checkbox-sm mr-3"
              ${r?"disabled":""}
            />
            <span class="label-text text-sm font-medium ${r?"text-gray-400":""}">
              ${i} ${n.label}${l}
            </span>
          </label>
        </li>`}),e===-1&&(e=0);const o=document.getElementById("rooms");o&&(o.innerHTML=t),f(e),setTimeout(()=>b(),0)}function f(t){window.lastRoomIndex=t;const e=window.apartmentData.rooms[t],o=window.apartmentData,n=document.getElementById("apl-checkbox"),a=n?n.checked:!1,i=v(e.price_history),l=i+o.charges-(a?100:0),{label:c}=A(e.available),r=document.getElementById("room");r&&(r.innerHTML=`${e.label}`);const s=document.getElementById("room-availability");s&&(c?(s.innerHTML=c.replace(" - ",""),s.style.display="block"):s.style.display="none");const p=document.querySelector(".loyer");p&&(p.innerHTML=i+" €");const h=document.querySelector(".apl");h&&(h.innerHTML=a?"-100 €":"0 €");const y=document.querySelector(".charges");y&&(y.innerHTML=o.charges+" €");const w=document.querySelector(".caution");w&&(w.innerHTML=o.caution+" €");const g=document.querySelector(".total");g&&(g.innerHTML=l+" €");const E=document.querySelector(".insurance");E&&(E.innerHTML="≈ "+o.insurance+" €");const d=document.getElementById("room-image"),m=document.getElementById("room-image-mobile");e.img&&(d&&(d.src=e.img,d.alt=e.label),m&&(m.src=e.img,m.alt=e.label)),document.querySelectorAll('input[name="room"]').forEach((k,M)=>{M===t?k.checked=!0:k.checked=!1})}function T(){if(window.lastRoomIndex!==-1){const t=window.apartmentData.rooms[window.lastRoomIndex],e=window.apartmentData,o=document.getElementById("apl-checkbox"),n=o?o.checked:!1,i=v(t.price_history)+e.charges-(n?100:0),l=document.querySelector(".apl");l&&(l.innerHTML=n?"-100 €":"0 €");const c=document.querySelector(".total");c&&(c.innerHTML=i+" €")}else u()}window.updatePrices=T;document.addEventListener("DOMContentLoaded",function(){u(),b(),setTimeout(()=>{L()},100),document.addEventListener("adminModeChanged",function(t){u(),b(),setTimeout(()=>{L()},100)})});function L(){if(document.querySelectorAll(".info-icon").forEach(e=>{const o=e.parentElement?.querySelector(".mobile-popover");if(e&&o&&!e.hasAttribute("data-initialized")){e.setAttribute("data-initialized","true");const n=a=>{a.stopPropagation(),document.querySelectorAll(".mobile-popover.show").forEach(i=>{i!==o&&i.classList.remove("show")}),o.classList.toggle("show")};e.addEventListener("click",n),e._clickHandler=n}}),!document.body.hasAttribute("data-popover-listener")){document.body.setAttribute("data-popover-listener","true");const e=o=>{o.target.closest(".info-icon")||document.querySelectorAll(".mobile-popover.show").forEach(n=>{n.classList.remove("show")})};document.addEventListener("click",e),document.body._clickOutsideHandler=e}}function b(){const t=document.querySelectorAll('input[name="room"]');t.forEach((e,o)=>{e.addEventListener("change",()=>{if(e.checked)t.forEach(n=>{n!==e&&(n.checked=!1)}),f(o);else if(!Array.from(t).some(a=>a.checked)){let a=0;const i=localStorage.getItem("adminMode")==="true"||document.body.classList.contains("admin")||typeof window.admin<"u"&&window.admin;for(let l=0;l<window.apartmentData.rooms.length;l++){const c=window.apartmentData.rooms[l];if(i||c.available!==!1){a=l;break}}t[a].checked=!0,f(a)}})})}
