function k(o,e=!1){let t="01/01/1970",n=0;return o.forEach(({date:a,price:c})=>{a>t&&(t=a,n=c)}),e?t:n}function v(o){return o==="disponible"?{icon:"",label:""}:o===!1?{icon:"❌",label:""}:typeof o=="string"?{icon:"",label:` - dispo le ${o}`}:{icon:"",label:""}}function u(){let o="",e=-1;window.apartmentData.rooms.forEach((n,a)=>{const{icon:c,label:i}=v(n.available),l=localStorage.getItem("adminMode")==="true"||document.body.classList.contains("admin")||typeof window.admin<"u"&&window.admin,r=!l&&n.available===!1,s=r?"opacity-50 cursor-not-allowed":"hover:bg-base-200 cursor-pointer";e===-1&&(l||n.available!==!1)&&(e=a),o+=`
        <li class="mb-0.5">
          <label class="label justify-start rounded-lg p-2 transition-colors select-none ${s}">
            <input
              type="checkbox"
              name="room"
              value="${a}"
              class="checkbox checkbox-primary checkbox-sm mr-3"
              ${r?"disabled":""}
            />
            <span class="label-text text-sm font-medium ${r?"text-gray-400":""}">
              ${c} ${n.labelFR}${i}
            </span>
          </label>
        </li>`}),e===-1&&(e=0);const t=document.getElementById("rooms");t&&(t.innerHTML=o),f(e),setTimeout(()=>p(),0)}function f(o){window.lastRoomIndex=o;const e=window.apartmentData.rooms[o],t=window.apartmentData,n=document.getElementById("apl-checkbox"),a=n?n.checked:!1,c=k(e.price_history),i=c+t.charges-(a?100:0),{label:l}=v(e.available),r=document.querySelector(".roomFR");r&&(r.innerHTML=`${e.labelFR}${l}`);const s=document.querySelector(".loyer");s&&(s.innerHTML=c+" €");const b=document.querySelector(".apl");b&&(b.innerHTML=a?"-100 €":"0 €");const h=document.querySelector(".charges");h&&(h.innerHTML=t.charges+" €");const w=document.querySelector(".caution");w&&(w.innerHTML=t.caution+" €");const y=document.querySelector(".total");y&&(y.innerHTML=i+" €");const g=document.querySelector(".insurance");g&&(g.innerHTML="≈ "+t.insurance+" €");const d=document.getElementById("room-image"),m=document.getElementById("room-image-mobile");e.img&&(d&&(d.src=e.img,d.alt=e.labelFR),m&&(m.src=e.img,m.alt=e.labelFR)),document.querySelectorAll('input[name="room"]').forEach((E,A)=>{A===o?E.checked=!0:E.checked=!1})}function S(){if(window.lastRoomIndex!==-1){const o=window.apartmentData.rooms[window.lastRoomIndex],e=window.apartmentData,t=document.getElementById("apl-checkbox"),n=t?t.checked:!1,c=k(o.price_history)+e.charges-(n?100:0),i=document.querySelector(".apl");i&&(i.innerHTML=n?"-100 €":"0 €");const l=document.querySelector(".total");l&&(l.innerHTML=c+" €")}else u()}window.updatePrices=S;document.addEventListener("DOMContentLoaded",function(){u(),p(),setTimeout(()=>{L()},100),document.addEventListener("adminModeChanged",function(o){u(),p(),setTimeout(()=>{L()},100)})});function L(){document.querySelectorAll(".tooltip").forEach(e=>{const t=e.querySelector(".info-icon"),n=e.querySelector(".mobile-popover");if(t&&n){const a=n.textContent?.trim()||"";e.setAttribute("data-tip",a),t.hasAttribute("data-initialized")||(t.setAttribute("data-initialized","true"),window.innerWidth<=800&&t.addEventListener("click",c=>{c.stopPropagation(),document.querySelectorAll(".mobile-popover.show").forEach(i=>{i!==n&&i.classList.remove("show")}),n.classList.toggle("show")}))}}),window.innerWidth<=800&&!document.body.hasAttribute("data-popover-listener")&&(document.body.setAttribute("data-popover-listener","true"),document.addEventListener("click",e=>{e.target.closest(".tooltip")||document.querySelectorAll(".mobile-popover.show").forEach(t=>{t.classList.remove("show")})}))}function p(){const o=document.querySelectorAll('input[name="room"]');o.forEach((e,t)=>{e.addEventListener("change",()=>{if(e.checked)o.forEach((n,a)=>{n!==e&&(n.checked=!1)}),f(t);else if(!Array.from(o).some(a=>a.checked)){let a=0;const c=localStorage.getItem("adminMode")==="true"||document.body.classList.contains("admin")||typeof window.admin<"u"&&window.admin;for(let i=0;i<window.apartmentData.rooms.length;i++){const l=window.apartmentData.rooms[i];if(c||l.available!==!1){a=i;break}}o[a].checked=!0,f(a)}})})}
